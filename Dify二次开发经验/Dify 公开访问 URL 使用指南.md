
### **Dify 公开访问 URL 使用指南 (Self-hosted K8s 环境)**

---

### **1. 概述**

本指南旨在为 Dify 自托管版本的用户，提供关于如何正确使用和分享“公开访问 URL”（如工作流链接、WebApp 链接等）的详细说明。

由于 Dify v1.3.0 在特定的 Kubernetes (`NodePort`) 部署模式下，其 URL 的自动生成逻辑存在缺陷，用户从界面直接复制的链接将无法从外部访问。本指南将说明产生该问题的原因，并提供一个简单的手动修正方法。

---

### **2. 根本原因说明**

#### **2.1 问题现象**

当您在 Dify 界面中创建一个应用或工作流，并点击“分享”或“获取公开链接”时，系统会自动生成一个类似如下格式的 URL：

`http://10.63.138.139/workflow/xxxxxx`

当您或外部用户尝试在浏览器中直接访问此链接时，会遇到“无法连接”或“Connection Refused”的错误。

#### **2.2 原因分析**

此问题的根本原因在于，Dify 的后端服务在生成这个供外部访问的 URL 时，未能正确识别出前端服务所暴露的端口号 (`30000`)。

*   **网络模型**：在当前的 Kubernetes 配置中，Dify 的前端用户界面是通过 `30000` 端口对外提供服务的。
*   **Dify 的缺陷**：我们通过源代码分析确认，Dify v1.3.0 的后端在生成链接时，错误地忽略了端口号，它默认认为服务是通过标准的 `80` 端口访问的。

因此，它生成了一个不完整的、缺少了关键端口信息的 URL，导致外部访问失败。

---

### **3. 正确的使用方法**

为了让公开访问链接能正常工作，用户在分享或使用链接前，需要进行一个简单的手动修正。

**操作步骤如下：**

1.  **从 Dify 界面复制链接**
    从 Dify 应用的分享功能中，正常复制系统生成的 URL。
2.  **手动修正链接**
    将复制的链接粘贴到任何文本编辑器或您的浏览器地址栏中。在 IP 地址 (或域名) 和路径 (以 `/` 开始的部分) 之间，**手动添加 `:30000`**。
3.  **使用修正后的链接**
    使用这个添加了端口号的、完整的 URL 进行访问或分享。

#### **示例：**

| | **链接地址** |
| :--- | :--- |
| **错误的链接 (从 Dify 界面直接复制)** | `http://10.63.138.139/workflow/F7vRSbaagmt2zU3v` |
| **正确的链接 (手动修正后)** | `http://10.63.138.139:30000/workflow/F7vRSbaagmt2zU3v` |

#### **如图所示：**

<img src="file:///C:/Users/202500626/Documents/WXWork/1688856109658359/Cache/Image/2025-07/企业微信截图_17518756561269.png" alt="img" style="zoom:50%;" />

---

### **4. 重要注意事项**

*   **适用范围**：此修正方法适用于所有从 Dify 生成的、供外部用户访问的公开链接，包括但不限于“工作流”和“WebApp”。
*   **API 集成地址**：请注意，此问题与“后端服务 API 集成”无关。供**程序**调用的 API 地址，使用的是另一个独立的端口 **`:32005`**，其正确的基地址为 `http://10.63.138.139:32005`。
*   **功能确认**：本问题仅为链接生成层面的显示缺陷，Dify 应用本身的所有后端功能（包括 API 服务）经测试均为**完全正常**，请放心使用。
